<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Knowledge Board (Level 4)</title>
<style>
    :root { --primary: #0ea5e9; --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --muted: #94a3b8; }
    body { font-family: "Segoe UI", sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh;}
    
    h1 { background: linear-gradient(to right, var(--primary), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; font-weight: 800; text-align: center; }

    /* Main Tabs (Level 1) */
    .main-tabs { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
    .main-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: var(--muted); padding: 10px 24px; border-radius: 25px; cursor: pointer; transition: 0.2s; font-weight: 700; font-size: 1rem; }
    .main-btn:hover, .main-btn.active { background: var(--primary); color: white; border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3); }

    /* Sub Tabs (Level 2) */
    .sub-tabs-container { width: 100%; max-width: 800px; margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; display: none; /* Hidden by default */ }
    .sub-tabs { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
    .sub-btn { background: transparent; border: 1px solid transparent; color: var(--muted); padding: 6px 16px; border-radius: 8px; cursor: pointer; transition: 0.2s; font-size: 0.9rem; }
    .sub-btn:hover { background: rgba(255,255,255,0.05); color: white; }
    .sub-btn.active { background: var(--card); color: var(--text); border-color: rgba(255,255,255,0.1); font-weight: 600; shadow: 0 2px 4px rgba(0,0,0,0.2); }

    /* Content Area (Level 3 & 4) */
    #content-area { width: 100%; max-width: 800px; }
    
    details { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 12px; overflow: hidden; }
    summary { padding: 16px; cursor: pointer; font-weight: bold; background: rgba(255,255,255,0.02); display: flex; justify-content: space-between; align-items: center; color: var(--primary); list-style: none; }
    summary::-webkit-details-marker { display: none; }
    summary::after { content: '+'; font-size: 1.2rem; font-weight: bold; }
    details[open] summary::after { content: '-'; }
    details[open] summary { border-bottom: 1px solid rgba(255,255,255,0.1); }

    .link-list { display: flex; flex-direction: column; }
    .link-item { display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); text-decoration: none; color: inherit; transition: 0.2s; }
    .link-item:hover { background: rgba(255,255,255,0.05); }
    .link-icon { width: 28px; height: 28px; border-radius: 4px; background: white; padding: 2px; object-fit: contain; }
    .link-info { display: flex; flex-direction: column; }
    .link-title { font-size: 0.95rem; font-weight: 500; }
    .link-url { font-size: 0.75rem; color: var(--muted); }

    #loading { margin-top: 50px; color: var(--primary); font-weight: bold; }
    .footer { margin-top: auto; padding-top: 30px; color: #64748b; font-size: 0.8rem; }
</style>
</head>
<body>

    <h1>ðŸ“š Knowledge Hub</h1>
    <div id="loading">Loading Data...</div>

    <div class="main-tabs" id="main-tabs"></div>

    <div class="sub-tabs-container" id="sub-tabs-container">
        <div class="sub-tabs" id="sub-tabs"></div>
    </div>

    <div id="content-area"></div>

    <div class="footer">Live Data from Google Sheets</div>

    <script>
        // ==========================================
        // ðŸ‘‡ á€¡á€…á€ºá€€á€­á€¯á€· Sheet ID á€€á€­á€¯ á€’á€®á€™á€¾á€¬á€‘á€Šá€·á€ºá€•á€« ðŸ‘‡
        // ==========================================
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTzZiVeEVnkYTU4TR2QQxNxOL6R-xEgrAloqMrJ0VtAuaXzu30qMLodfO33vON0r6gxIQ1CSpzUb5PB/pub?output=csv";
        // ==========================================

        let data = {};
        let currentMain = "";

        async function init() {
            try {
                const res = await fetch(CSV_URL);
                if(!res.ok) throw new Error("Connection Failed");
                const text = await res.text();
                
                if(text.includes("<!DOCTYPE html>")) throw new Error("Not a CSV link");

                parseCSV(text);
                document.getElementById('loading').style.display = 'none';
                renderMainTabs();

            } catch (e) {
                document.getElementById('loading').innerText = "Error: " + e.message;
            }
        }

        function parseCSV(csvText) {
            const rows = csvText.split('\n');
            // Row 0 is Header, Start from 1
            for(let i=1; i<rows.length; i++) {
                // Regex to split by comma, ignoring commas inside quotes
                const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(c => c.replace(/^"|"$/g, '').trim());
                
                // Expected: Main, Sub, Topic, Name, Url
                const main = cols[0];
                const sub = cols[1];
                const topic = cols[2];
                const name = cols[3];
                const url = cols[4];

                if(!main || !url) continue;

                if(!data[main]) data[main] = {};
                if(!data[main][sub]) data[main][sub] = {};
                if(!data[main][sub][topic]) data[main][sub][topic] = [];

                data[main][sub][topic].push({ name, url });
            }
        }

        function renderMainTabs() {
            const container = document.getElementById('main-tabs');
            const keys = Object.keys(data);
            
            keys.forEach((cat, idx) => {
                const btn = document.createElement('button');
                btn.className = 'main-btn';
                btn.innerText = cat;
                btn.onclick = () => setMainTab(cat, btn);
                container.appendChild(btn);
                if(idx === 0) setTimeout(() => btn.click(), 50);
            });
        }

        function setMainTab(cat, btn) {
            currentMain = cat;
            document.querySelectorAll('.main-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderSubTabs(cat);
        }

        function renderSubTabs(mainCat) {
            const container = document.getElementById('sub-tabs');
            const wrapper = document.getElementById('sub-tabs-container');
            container.innerHTML = '';
            
            const subKeys = Object.keys(data[mainCat]);
            
            if(subKeys.length > 0) {
                wrapper.style.display = 'block';
                subKeys.forEach((sub, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'sub-btn';
                    btn.innerText = sub;
                    btn.onclick = () => setSubTab(sub, btn);
                    container.appendChild(btn);
                    if(idx === 0) setTimeout(() => btn.click(), 10);
                });
            } else {
                wrapper.style.display = 'none';
                document.getElementById('content-area').innerHTML = '<p style="text-align:center">No Content</p>';
            }
        }

        function setSubTab(subCat, btn) {
            document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderContent(currentMain, subCat);
        }

        function renderContent(main, sub) {
            const container = document.getElementById('content-area');
            container.innerHTML = '';

            const topics = data[main][sub]; // This is an Object { "TopicName": [links], ... }

            Object.keys(topics).forEach(topicName => {
                const details = document.createElement('details');
                details.open = true;

                const summary = document.createElement('summary');
                summary.innerText = topicName;
                details.appendChild(summary);

                const list = document.createElement('div');
                list.className = 'link-list';

                topics[topicName].forEach(link => {
                    let domain = "";
                    try { domain = new URL(link.url).hostname; } catch(e){ domain = "google.com"; }
                    const icon = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;

                    const a = document.createElement('a');
                    a.className = 'link-item';
                    a.href = link.url;
                    a.target = "_blank";
                    a.innerHTML = `
                        <img src="${icon}" class="link-icon" onerror="this.src='https://via.placeholder.com/28'">
                        <div class="link-info">
                            <span class="link-title">${link.name}</span>
                            <span class="link-url">${link.url}</span>
                        </div>
                    `;
                    list.appendChild(a);
                });

                details.appendChild(list);
                container.appendChild(details);
            });
        }

        init();
    </script>
</body>
</html>
